<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Dividend Optimizer</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: #09090b;
        }

        .sidebar {
            background: linear-gradient(180deg, #0f0f12 0%, #0a0a0c 100%);
        }

        .nav-item {
            transition: all 0.2s ease;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-item.active {
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid #667eea;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
    </style>
</head>

<body class="text-white flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside class="sidebar w-64 flex flex-col border-r border-white/10">

        <!-- Logo -->
        <div class="p-6 border-b border-white/10">
            <a href="/" class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center">
                    <i class="fas fa-chart-pie"></i>
                </div>
                <span class="font-bold text-lg">Dividend</span>
            </a>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 py-4">
            <ul class="space-y-1 px-3">
                <li>
                    <button onclick="switchTab('overview')" id="nav-overview"
                        class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left">
                        <i class="fas fa-home w-5 text-gray-400"></i>
                        <span>Overview</span>
                    </button>
                </li>
                <li>
                    <button onclick="switchTab('dividend')" id="nav-dividend"
                        class="nav-item active w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left">
                        <i class="fas fa-coins w-5 text-purple-400"></i>
                        <span>ë°°ë‹¹ ìµœì í™”</span>
                    </button>
                </li>
                <li>
                    <button onclick="switchTab('analysis')" id="nav-analysis"
                        class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left">
                        <i class="fas fa-chart-line w-5 text-gray-400"></i>
                        <span>ë¶„ì„</span>
                    </button>
                </li>
                <li>
                    <button onclick="switchTab('settings')" id="nav-settings"
                        class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left">
                        <i class="fas fa-cog w-5 text-gray-400"></i>
                        <span>ì„¤ì •</span>
                    </button>
                </li>
            </ul>
        </nav>

        <!-- Footer -->
        <div class="p-4 border-t border-white/10 text-xs text-gray-500">
            <p>v1.0.0 | Â© 2024</p>
            <div class="flex items-center gap-1 mt-1">
                <i class="fas fa-users text-purple-400 text-[10px]"></i>
                <span>ë°©ë¬¸ì: <span id="visitorCount" class="text-white">-</span></span>
            </div>
        </div>

    </aside>


    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto">

        <!-- Overview Section -->
        <div id="content-overview" class="content-section p-8">
            <h1 class="text-3xl font-bold mb-2">Overview</h1>
            <p class="text-gray-400 mb-8">ë°°ë‹¹ ìœ ë‹ˆë²„ìŠ¤ í˜„í™© ë° ì£¼ìš” ì§€í‘œ</p>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="stat-card rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center">
                            <i class="fas fa-database text-blue-400"></i>
                        </div>
                        <span class="text-gray-400 text-sm">ì´ í‹°ì»¤</span>
                    </div>
                    <div class="text-3xl font-bold" id="statTotalTickers">-</div>
                </div>
                <div class="stat-card rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center">
                            <i class="fas fa-layer-group text-purple-400"></i>
                        </div>
                        <span class="text-gray-400 text-sm">ETF</span>
                    </div>
                    <div class="text-3xl font-bold" id="statETFCount">-</div>
                </div>
                <div class="stat-card rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center">
                            <i class="fas fa-building text-green-400"></i>
                        </div>
                        <span class="text-gray-400 text-sm">ê°œë³„ì£¼</span>
                    </div>
                    <div class="text-3xl font-bold" id="statStockCount">-</div>
                </div>
                <div class="stat-card rounded-2xl p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center">
                            <i class="fas fa-tags text-orange-400"></i>
                        </div>
                        <span class="text-gray-400 text-sm">íˆ¬ì í…Œë§ˆ</span>
                    </div>
                    <div class="text-3xl font-bold" id="statThemeCount">10</div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">ë°°ë‹¹ë¥  ë¶„í¬</h3>
                    <div class="h-64">
                        <canvas id="yieldDistChart"></canvas>
                    </div>
                </div>
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">ì§€ê¸‰ ë¹ˆë„</h3>
                    <div class="h-64">
                        <canvas id="freqChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Top Yielders Table -->
            <div class="glass-card rounded-2xl p-6">
                <h3 class="text-lg font-semibold mb-4">Top 10 ë°°ë‹¹ë¥ </h3>
                <table class="w-full">
                    <thead>
                        <tr class="text-left text-gray-500 text-sm border-b border-white/10">
                            <th class="pb-3">í‹°ì»¤</th>
                            <th class="pb-3">ì´ë¦„</th>
                            <th class="pb-3 text-right">ë°°ë‹¹ë¥ </th>
                            <th class="pb-3 text-right">ì§€ê¸‰ ë¹ˆë„</th>
                        </tr>
                    </thead>
                    <tbody id="topYieldersTable">
                        <tr>
                            <td colspan="4" class="py-4 text-center text-gray-500">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Dividend Section (iframe) -->
        <div id="content-dividend" class="content-section active h-full">
            <iframe src="/dividend" class="w-full h-full border-0" title="Dividend Optimizer"></iframe>
        </div>

        <!-- Analysis Section -->
        <div id="content-analysis" class="content-section p-8">
            <h1 class="text-3xl font-bold mb-2">ê°œë³„ ì¢…ëª© ë¶„ì„</h1>
            <p class="text-gray-400 mb-8">ì¢…ëª©ì„ ì„ íƒí•˜ì—¬ ë¦¬ìŠ¤í¬ ë° ë°°ë‹¹ ì§€ì†ì„±ì„ ë¶„ì„í•©ë‹ˆë‹¤.</p>

            <!-- Ticker Search -->
            <div class="glass-card rounded-2xl p-6 mb-8">
                <div class="flex gap-4">
                    <input type="text" id="analysisTicker" placeholder="í‹°ì»¤ ì…ë ¥ (ì˜ˆ: SCHD, JEPI)"
                        class="flex-1 bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-purple-500 focus:outline-none">
                    <button onclick="analyzeStock()"
                        class="px-6 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl font-semibold hover:opacity-90 transition">
                        <i class="fas fa-search mr-2"></i>ë¶„ì„
                    </button>
                </div>
            </div>

            <!-- Results -->
            <div id="analysisResults" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Risk Metrics -->
                    <div class="glass-card rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-shield-alt text-blue-400"></i>ë¦¬ìŠ¤í¬ ì§€í‘œ
                        </h3>
                        <div id="riskMetricsContent" class="space-y-4">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <!-- Sustainability -->
                    <div class="glass-card rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-leaf text-green-400"></i>ë°°ë‹¹ ì§€ì†ì„±
                        </h3>
                        <div id="sustainabilityContent" class="space-y-4">
                            <!-- Filled by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="content-settings" class="content-section p-8">
            <h1 class="text-3xl font-bold mb-2">ì„¤ì •</h1>
            <p class="text-gray-400 mb-8">ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>

            <div class="max-w-2xl space-y-6">
                <!-- Default Settings -->
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">ê¸°ë³¸ ì„¤ì •</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">ê¸°ë³¸ í™˜ìœ¨ (â‚©/$)</label>
                            <input type="number" id="settingFxRate" value="1420"
                                class="w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-purple-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">ì„¸ìœ¨ (%)</label>
                            <input type="number" id="settingTaxRate" value="15.4" step="0.1"
                                class="w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-purple-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">ê¸°ë³¸ ì›” ëª©í‘œ (â‚©)</label>
                            <input type="number" id="settingTarget" value="1000000" step="100000"
                                class="w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-purple-500 focus:outline-none">
                        </div>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">ë°ì´í„° ê´€ë¦¬</h3>
                    <p class="text-gray-400 text-sm mb-4">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastDataUpdate">-</span></p>
                    <button onclick="alert('ë°ì´í„° ê°±ì‹ ì€ ì„œë²„ì—ì„œ loader.pyë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”.')"
                        class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm transition">
                        <i class="fas fa-sync-alt mr-2"></i>ë°ì´í„° ê°±ì‹  ì•ˆë‚´
                    </button>
                </div>

                <!-- About -->
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">About</h3>
                    <p class="text-gray-400 text-sm">
                        Dividend Optimizer v1.0.0<br>
                        AI ê¸°ë°˜ ë°°ë‹¹ í¬íŠ¸í´ë¦¬ì˜¤ ìµœì í™” ì‹œìŠ¤í…œ<br>
                        Built with Flask + Tailwind CSS + Chart.js
                    </p>
                </div>
            </div>
        </div>

    </main>


    <script>
        // Tab switching logic
        function switchTab(tabId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const content = document.getElementById('content-' + tabId);
            if (content) content.classList.add('active');
            const nav = document.getElementById('nav-' + tabId);
            if (nav) nav.classList.add('active');

            // Load data when switching to overview
            if (tabId === 'overview') loadOverviewData();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('dividend');
        });

        // Load Overview Data
        async function loadOverviewData() {
            try {
                const themesRes = await fetch('/api/dividend/themes');
                const themesData = await themesRes.json();

                if (themesData.meta) {
                    document.getElementById('statTotalTickers').textContent = themesData.meta.total_tickers || '-';
                    document.getElementById('lastDataUpdate').textContent = themesData.meta.last_updated || '-';
                }

                // Mock counts (could be fetched from actual API)
                document.getElementById('statETFCount').textContent = '88';
                document.getElementById('statStockCount').textContent = '126';
                document.getElementById('statThemeCount').textContent = themesData.themes?.length || 10;

                // Load universe data for charts
                loadUniverseCharts();

            } catch (e) {
                console.error('Failed to load overview data:', e);
            }
        }

        async function loadUniverseCharts() {
            // Yield Distribution Chart
            const yieldCtx = document.getElementById('yieldDistChart').getContext('2d');
            new Chart(yieldCtx, {
                type: 'bar',
                data: {
                    labels: ['0-2%', '2-4%', '4-6%', '6-8%', '8-10%', '10%+'],
                    datasets: [{
                        label: 'ì¢…ëª© ìˆ˜',
                        data: [25, 45, 50, 35, 28, 31],
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#666' } },
                        x: { grid: { display: false }, ticks: { color: '#666' } }
                    }
                }
            });

            // Frequency Chart
            const freqCtx = document.getElementById('freqChart').getContext('2d');
            new Chart(freqCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Monthly', 'Quarterly', 'Semi-Annual', 'Annual'],
                    datasets: [{
                        data: [65, 120, 15, 14],
                        backgroundColor: ['#30d158', '#2997ff', '#ff9f0a', '#ff453a']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { color: '#999', padding: 15 } }
                    }
                }
            });

            // Top Yielders
            document.getElementById('topYieldersTable').innerHTML = `
                <tr class="border-b border-white/5"><td class="py-3 font-bold">QYLG</td><td class="text-gray-400">Global X NASDAQ 100 Covered Call & Growth</td><td class="text-right text-green-400">24.46%</td><td class="text-right text-gray-400">Monthly</td></tr>
                <tr class="border-b border-white/5"><td class="py-3 font-bold">XYLG</td><td class="text-gray-400">Global X S&P 500 Covered Call & Growth</td><td class="text-right text-green-400">23.31%</td><td class="text-right text-gray-400">Monthly</td></tr>
                <tr class="border-b border-white/5"><td class="py-3 font-bold">QQQI</td><td class="text-gray-400">NEOS Nasdaq-100 High Income</td><td class="text-right text-green-400">13.64%</td><td class="text-right text-gray-400">Monthly</td></tr>
                <tr class="border-b border-white/5"><td class="py-3 font-bold">QYLD</td><td class="text-gray-400">Global X NASDAQ 100 Covered Call</td><td class="text-right text-green-400">13.41%</td><td class="text-right text-gray-400">Monthly</td></tr>
                <tr class="border-b border-white/5"><td class="py-3 font-bold">AGNC</td><td class="text-gray-400">AGNC Investment Corp</td><td class="text-right text-green-400">13.31%</td><td class="text-right text-gray-400">Monthly</td></tr>
                <tr class="border-b border-white/5"><td class="py-3 font-bold">RYLD</td><td class="text-gray-400">Global X Russell 2000 Covered Call</td><td class="text-right text-green-400">12.95%</td><td class="text-right text-gray-400">Monthly</td></tr>
                <tr class="border-b border-white/5"><td class="py-3 font-bold">NLY</td><td class="text-gray-400">Annaly Capital Management</td><td class="text-right text-green-400">11.95%</td><td class="text-right text-gray-400">Quarterly</td></tr>
                <tr class="border-b border-white/5"><td class="py-3 font-bold">SPYI</td><td class="text-gray-400">NEOS S&P 500 High Income</td><td class="text-right text-green-400">11.60%</td><td class="text-right text-gray-400">Monthly</td></tr>
                <tr class="border-b border-white/5"><td class="py-3 font-bold">HTGC</td><td class="text-gray-400">Hercules Capital</td><td class="text-right text-green-400">10.04%</td><td class="text-right text-gray-400">Quarterly</td></tr>
                <tr><td class="py-3 font-bold">JEPQ</td><td class="text-gray-400">JPMorgan Nasdaq Equity Premium Income</td><td class="text-right text-green-400">10.12%</td><td class="text-right text-gray-400">Monthly</td></tr>
            `;
        }

        // Stock Analysis
        async function analyzeStock() {
            const ticker = document.getElementById('analysisTicker').value.toUpperCase().trim();
            if (!ticker) return;

            document.getElementById('analysisResults').classList.remove('hidden');
            document.getElementById('riskMetricsContent').innerHTML = '<p class="text-gray-500">Loading...</p>';
            document.getElementById('sustainabilityContent').innerHTML = '<p class="text-gray-500">Loading...</p>';

            try {
                // Fetch Risk Metrics
                const riskRes = await fetch(`/api/dividend/risk-metrics/${ticker}`);
                const riskData = await riskRes.json();

                if (riskData.error) {
                    document.getElementById('riskMetricsContent').innerHTML = `<p class="text-red-400">${riskData.error}</p>`;
                } else {
                    // Volatility interpretation
                    const vol = riskData.volatility_annual;
                    let volLevel = 'ë³´í†µ';
                    let volColor = 'text-yellow-400';
                    if (vol < 0.15) { volLevel = 'ë‚®ìŒ (ì•ˆì •ì )'; volColor = 'text-green-400'; }
                    else if (vol > 0.25) { volLevel = 'ë†’ìŒ (ì£¼ì˜)'; volColor = 'text-red-400'; }

                    // MDD interpretation
                    const mdd = Math.abs(riskData.max_drawdown || 0);
                    let mddLevel = 'ë³´í†µ';
                    if (mdd < 0.15) mddLevel = 'ì–‘í˜¸';
                    else if (mdd > 0.30) mddLevel = 'ì£¼ì˜';

                    // Sharpe interpretation
                    const sharpe = riskData.sharpe_ratio;
                    let sharpeLevel = 'ë³´í†µ';
                    if (sharpe > 1) sharpeLevel = 'ìš°ìˆ˜';
                    else if (sharpe < 0) sharpeLevel = 'ë¶€ì§„';

                    // Beta interpretation
                    const beta = riskData.beta;
                    let betaLevel = 'ì‹œì¥ê³¼ ìœ ì‚¬';
                    if (beta < 0.8) betaLevel = 'ì‹œì¥ë³´ë‹¤ ì•ˆì •ì ';
                    else if (beta > 1.2) betaLevel = 'ì‹œì¥ë³´ë‹¤ ë¯¼ê°';

                    document.getElementById('riskMetricsContent').innerHTML = `
                        <div class="py-3 border-b border-white/5">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-white font-medium">ğŸ“Š ì—°ê°„ ë³€ë™ì„±</span>
                                <span class="font-mono ${volColor}">${vol ? (vol * 100).toFixed(1) + '%' : 'N/A'}</span>
                            </div>
                            <p class="text-xs text-gray-500">ì£¼ê°€ê°€ 1ë…„ê°„ ì–¼ë§ˆë‚˜ ì¶œë ì˜€ëŠ”ì§€ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. <span class="${volColor}">${volLevel}</span></p>
                            <p class="text-[10px] text-gray-600 mt-1">ğŸ’¡ 15% ì´í•˜ë©´ ì•ˆì •ì , 25% ì´ìƒì´ë©´ ë³€ë™ì„± í¼</p>
                        </div>
                        <div class="py-3 border-b border-white/5">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-white font-medium">ğŸ“‰ ìµœëŒ€ ë‚™í­ (MDD)</span>
                                <span class="font-mono text-red-400">${riskData.max_drawdown ? (riskData.max_drawdown * 100).toFixed(1) + '%' : 'N/A'}</span>
                            </div>
                            <p class="text-xs text-gray-500">ê³ ì ì—ì„œ ìµœëŒ€ ëª‡ % ë–¨ì–´ì¡ŒëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤. (${mddLevel})</p>
                            <p class="text-[10px] text-gray-600 mt-1">ğŸ’¡ -20% ì´ë‚´ë©´ ì–‘í˜¸, -30% ë„˜ìœ¼ë©´ ê³ ìœ„í—˜</p>
                        </div>
                        <div class="py-3 border-b border-white/5">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-white font-medium">âš–ï¸ ìƒ¤í”„ ë¹„ìœ¨</span>
                                <span class="font-mono">${sharpe ?? 'N/A'}</span>
                            </div>
                            <p class="text-xs text-gray-500">ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµì´ ì–¼ë§ˆë‚˜ ì¢‹ì€ì§€ ì¸¡ì •í•©ë‹ˆë‹¤. (${sharpeLevel})</p>
                            <p class="text-[10px] text-gray-600 mt-1">ğŸ’¡ 1 ì´ìƒì´ë©´ ìš°ìˆ˜, 0 ì´í•˜ë©´ ë¶€ì§„</p>
                        </div>
                        <div class="py-3 border-b border-white/5">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-white font-medium">ğŸ“ˆ ë² íƒ€</span>
                                <span class="font-mono">${beta ?? 'N/A'}</span>
                            </div>
                            <p class="text-xs text-gray-500">S&P 500 ëŒ€ë¹„ ë¯¼ê°ë„ì…ë‹ˆë‹¤. (${betaLevel})</p>
                            <p class="text-[10px] text-gray-600 mt-1">ğŸ’¡ 1 = ì‹œì¥ê³¼ ë™ì¼, 0.8 ì´í•˜ = ë°©ì–´ì£¼, 1.2 ì´ìƒ = ê³µê²©ì£¼</p>
                        </div>
                        <div class="py-3">
                            <div class="flex justify-between items-center">
                                <span class="text-white font-medium">ğŸ† ì¢…í•© ë¦¬ìŠ¤í¬ ë“±ê¸‰</span>
                                <span class="px-3 py-1 rounded-lg ${riskData.risk_grade === 'A' ? 'bg-green-500/20 text-green-400' : riskData.risk_grade === 'B' ? 'bg-blue-500/20 text-blue-400' : 'bg-orange-500/20 text-orange-400'} font-bold">${riskData.risk_grade}</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">A = ì €ìœ„í—˜, B = ì¤‘ìœ„í—˜, C = ê³ ìœ„í—˜</p>
                        </div>
                    `;
                }

                // Fetch Sustainability
                const susRes = await fetch(`/api/dividend/sustainability/${ticker}`);
                const susData = await susRes.json();

                // Check if we have ANY valid data (safety object is always returned)
                if (susData && susData.safety) {
                    const safety = susData.safety;
                    const payout = susData.payout_ratio;
                    const growth = susData.dividend_growth_5y;
                    const streak = susData.dividend_streak;

                    // Payout interpretation
                    let payoutLevel = 'ì •ë³´ ì—†ìŒ';
                    let payoutColor = 'text-gray-400';
                    if (payout !== null) {
                        if (payout < 0.5) { payoutLevel = 'ì•ˆì „'; payoutColor = 'text-green-400'; }
                        else if (payout < 0.7) { payoutLevel = 'ì ì •'; payoutColor = 'text-yellow-400'; }
                        else { payoutLevel = 'ìœ„í—˜'; payoutColor = 'text-red-400'; }
                    }

                    // Growth interpretation
                    let growthLevel = 'ì •ë³´ ì—†ìŒ';
                    if (growth !== null) {
                        if (growth > 0.05) growthLevel = 'ì„±ì¥ ì¤‘';
                        else if (growth > 0) growthLevel = 'ìœ ì§€';
                        else growthLevel = 'ê°ì†Œ';
                    }

                    document.getElementById('sustainabilityContent').innerHTML = `
                        <div class="py-3 border-b border-white/5">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-white font-medium">ğŸ’° Payout Ratio</span>
                                <span class="font-mono ${payoutColor}">${payout !== null ? (payout * 100).toFixed(0) + '%' : 'N/A'}</span>
                            </div>
                            <p class="text-xs text-gray-500">ì´ìµ ëŒ€ë¹„ ë°°ë‹¹ê¸ˆ ë¹„ìœ¨ì…ë‹ˆë‹¤. ${payout !== null ? `(${payoutLevel})` : ''}</p>
                            <p class="text-[10px] text-gray-600 mt-1">ğŸ’¡ 50% ì´í•˜ë©´ ì•ˆì „, 70% ì´ìƒì´ë©´ ì§€ì†ì„± ìš°ë ¤</p>
                        </div>
                        <div class="py-3 border-b border-white/5">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-white font-medium">ğŸ“ˆ ë°°ë‹¹ ì„±ì¥ë¥  (5ë…„)</span>
                                <span class="font-mono ${growth > 0 ? 'text-green-400' : growth < 0 ? 'text-red-400' : ''}">${growth !== null ? (growth * 100).toFixed(1) + '%' : 'N/A'}</span>
                            </div>
                            <p class="text-xs text-gray-500">ìµœê·¼ 5ë…„ê°„ ë°°ë‹¹ê¸ˆì´ ì–¼ë§ˆë‚˜ ì¦ê°€í–ˆëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤. (${growthLevel})</p>
                            <p class="text-[10px] text-gray-600 mt-1">ğŸ’¡ ì–‘ìˆ˜ë©´ ë°°ë‹¹ì´ ëŠ˜ì–´ë‚˜ëŠ” ì¶”ì„¸</p>
                        </div>
                        <div class="py-3 border-b border-white/5">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-white font-medium">ğŸ—“ï¸ ì—°ì† ì§€ê¸‰ ì—°ìˆ˜</span>
                                <span class="font-mono text-white">${streak ?? 0}ë…„</span>
                            </div>
                            <p class="text-xs text-gray-500">ë°°ë‹¹ì„ ëŠê¸°ì§€ ì•Šê³  ì§€ê¸‰í•œ ì—°ìˆ˜ì…ë‹ˆë‹¤.</p>
                            <p class="text-[10px] text-gray-600 mt-1">ğŸ’¡ 10ë…„ ì´ìƒì´ë©´ ì•ˆì •ì , 25ë…„ ì´ìƒì€ ë°°ë‹¹ ê·€ì¡±</p>
                        </div>
                        <div class="py-3">
                            <div class="flex justify-between items-center">
                                <span class="text-white font-medium">ğŸ›¡ï¸ ì¢…í•© ì•ˆì •ì„± ì ìˆ˜</span>
                                <span class="px-3 py-1 rounded-lg ${safety.safety_grade === 'A' ? 'bg-green-500/20 text-green-400' : safety.safety_grade === 'B' ? 'bg-blue-500/20 text-blue-400' : safety.safety_grade === 'C' ? 'bg-yellow-500/20 text-yellow-400' : 'bg-red-500/20 text-red-400'} font-bold">${safety.safety_score}/100 (${safety.safety_grade})</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">A = ë§¤ìš° ì•ˆì •, B = ì–‘í˜¸, C = ë³´í†µ, D = ì£¼ì˜</p>
                        </div>
                    `;
                } else {
                    document.getElementById('sustainabilityContent').innerHTML = `<p class="text-gray-500">ì´ ì¢…ëª©ì˜ ë°°ë‹¹ ì§€ì†ì„± ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
                }

            } catch (e) {
                console.error(e);
                document.getElementById('riskMetricsContent').innerHTML = `<p class="text-red-400">API ì˜¤ë¥˜: ${e.message}</p>`;
                document.getElementById('sustainabilityContent').innerHTML = `<p class="text-red-400">API ì˜¤ë¥˜</p>`;
            }
        }

        // Visitor Counter using CountAPI
        (async function () {
            try {
                const namespace = 'dividend-optimizer';
                const key = 'visits';
                const res = await fetch(`https://api.countapi.xyz/hit/${namespace}/${key}`);
                const data = await res.json();
                const el = document.getElementById('visitorCount');
                if (el) el.textContent = data.value.toLocaleString();
            } catch (e) {
                console.log('Visitor count failed');
            }
        })();

    </script>

</body>

</html>